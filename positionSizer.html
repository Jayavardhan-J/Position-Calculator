<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Position Size Calculator</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (CDNJS for better stability) -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    
    <!-- Babel (Standalone) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Hide scrollbar for chrome/safari/opera */
        .no-scrollbar::-webkit-scrollbar {
          display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
          -ms-overflow-style: none;  /* IE and Edge */
          scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 antialiased selection:bg-blue-500/30">
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. Data Constants (Defined globally to ensure availability) ---
        const CATEGORIES = {
            FOREX: 'Forex',
            INDICES: 'Indices',
            COMMODITIES: 'Commodities',
            CRYPTO: 'Crypto',
        };

        const INSTRUMENTS = {
            [CATEGORIES.FOREX]: [
                { symbol: 'Standard Pair (EURUSD, etc.)', contractSize: 100000, leverage: 100 },
            ],
            [CATEGORIES.INDICES]: [
                { symbol: 'Standard Index (US30, NAS100)', contractSize: 10, leverage: 15 },
            ],
            [CATEGORIES.COMMODITIES]: [
                { symbol: 'Gold / Oil / Other', contractSize: 100, leverage: 15 },
                { symbol: 'XAGUSD (Silver)', contractSize: 5000, leverage: 15 },
            ],
            [CATEGORIES.CRYPTO]: [
                { symbol: 'ADAUSD', contractSize: 100, leverage: 1 },
                { symbol: 'BCHUSD', contractSize: 1, leverage: 1 },
                { symbol: 'BTCUSD', contractSize: 1, leverage: 1 },
                { symbol: 'DOGUSD', contractSize: 1000, leverage: 1 },
                { symbol: 'ETHUSD', contractSize: 1, leverage: 1 },
                { symbol: 'LNKUSD', contractSize: 100, leverage: 1 },
                { symbol: 'LTCUSD', contractSize: 1, leverage: 1 },
                { symbol: 'XLMUSD', contractSize: 100, leverage: 1 },
                { symbol: 'XMRUSD', contractSize: 1, leverage: 1 },
                { symbol: 'XRPUSD', contractSize: 100, leverage: 1 },
                { symbol: 'Other Crypto (Standard)', contractSize: 1, leverage: 1 },
            ],
        };

        const { useState, useEffect } = React;

        // --- 2. Icons Components ---
        const Activity = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
        );
        const TrendingUp = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        );
        const Settings = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        );
        const Calculator = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
        );
        const DollarSign = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        );
        const AlertCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
        );

        // --- 3. UI Component: InputField ---
        const InputField = ({ label, value, onChange, placeholder, type = "number", prefix, step = "any" }) => (
            <div className="flex flex-col space-y-1 w-full">
                <label className="text-xs font-medium text-slate-400 uppercase tracking-wider ml-1">{label}</label>
                <div className="relative group">
                    {prefix && (
                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span className="text-slate-500">{prefix}</span>
                        </div>
                    )}
                    <input
                        type={type}
                        step={step}
                        value={value}
                        onChange={(e) => onChange(e.target.value)} 
                        placeholder={placeholder}
                        className={`w-full bg-slate-800/50 border border-slate-700 text-slate-100 text-sm rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 block p-3 ${prefix ? 'pl-7' : ''} transition-all duration-200 placeholder-slate-600`}
                    />
                </div>
            </div>
        );

        // --- 4. Main Component ---
        const PositionSizeCalculator = () => {
            const [category, setCategory] = useState(CATEGORIES.FOREX);
            const [selectedInstrument, setSelectedInstrument] = useState(INSTRUMENTS[CATEGORIES.FOREX][0]);
            
            const [entryPrice, setEntryPrice] = useState('');
            const [stopLoss, setStopLoss] = useState('');
            const [target, setTarget] = useState('');
            const [riskReward, setRiskReward] = useState(''); 
            const [riskAmount, setRiskAmount] = useState(100);
            
            const [results, setResults] = useState(null);

            const handleCategoryChange = (newCat) => {
                setCategory(newCat);
                if (INSTRUMENTS[newCat] && INSTRUMENTS[newCat].length > 0) {
                    setSelectedInstrument(INSTRUMENTS[newCat][0]);
                }
            };

            const handleTargetChange = (val) => {
                setTarget(val);
                const entry = parseFloat(entryPrice);
                const sl = parseFloat(stopLoss);
                const tp = parseFloat(val);

                if (!isNaN(entry) && !isNaN(sl) && !isNaN(tp) && entry !== sl) {
                    const distSL = Math.abs(entry - sl);
                    const distTP = Math.abs(entry - tp);
                    const newRR = distTP / distSL;
                    setRiskReward(newRR.toFixed(2));
                } else {
                    setRiskReward('');
                }
            };

            const handleRRChange = (val) => {
                setRiskReward(val);
                const rr = parseFloat(val);
                const entry = parseFloat(entryPrice);
                const sl = parseFloat(stopLoss);

                if (!isNaN(rr) && !isNaN(entry) && !isNaN(sl) && entry !== sl) {
                    const isLong = entry > sl;
                    const dist = Math.abs(entry - sl);
                    const profitDist = dist * rr;
                    
                    const newTarget = isLong ? entry + profitDist : entry - profitDist;
                    
                    const decimalMatch = entryPrice.toString().split('.')[1];
                    const precision = decimalMatch ? decimalMatch.length : 2;
                    
                    setTarget(newTarget.toFixed(precision));
                }
            };

            useEffect(() => {
                const entry = parseFloat(entryPrice);
                const sl = parseFloat(stopLoss);
                const tp = parseFloat(target);
                const risk = parseFloat(riskAmount);

                // Defensive check: ensure instrument exists
                if (!selectedInstrument) return;

                if (isNaN(entry) || isNaN(sl) || isNaN(risk) || entry === sl) {
                    setResults(null);
                    return;
                }

                const isLong = entry > sl;
                const direction = isLong ? 'Long' : 'Short';
                const slDistance = Math.abs(entry - sl);
                const tpDistance = isNaN(tp) ? 0 : Math.abs(entry - tp);

                // Lot Calculation
                const rawLotSize = risk / (selectedInstrument.contractSize * slDistance);
                let lotSize = rawLotSize;

                // Margin Calculation
                const marginRequired = (entry * selectedInstrument.contractSize * rawLotSize) / selectedInstrument.leverage;

                // RR Calculation
                let rrRatio = 0;
                if (!isNaN(tp) && tpDistance > 0) {
                    rrRatio = tpDistance / slDistance;
                }

                const potentialProfit = rrRatio * risk;

                setResults({
                    lotSize: lotSize,
                    direction,
                    margin: marginRequired,
                    rr: rrRatio,
                    potentialProfit,
                    slDistance,
                    contractSize: selectedInstrument.contractSize,
                    leverage: selectedInstrument.leverage
                });
            }, [category, selectedInstrument, entryPrice, stopLoss, target, riskAmount]);

            return (
                <div className="min-h-screen p-4 md:p-8 flex justify-center items-start">
                    <div className="max-w-5xl w-full grid grid-cols-1 lg:grid-cols-12 gap-8">
                        
                        {/* Header */}
                        <div className="lg:col-span-12 mb-4">
                            <h1 className="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-indigo-400 flex items-center gap-3">
                                <Activity className="text-blue-500" />
                                Position Size Calculator
                            </h1>
                            <p className="text-slate-400 mt-2">Calculate accurate lot sizes and risk for Forex, Indices, Commodities & Crypto.</p>
                        </div>

                        {/* --- Inputs --- */}
                        <div className="lg:col-span-7 space-y-6">
                            
                            {/* Instrument Card */}
                            <div className="bg-slate-900 border border-slate-800 rounded-2xl p-6 shadow-xl">
                                <div className="flex items-center gap-2 mb-6 border-b border-slate-800 pb-4">
                                    <TrendingUp className="w-5 h-5 text-indigo-400" />
                                    <h2 className="text-lg font-semibold text-slate-200">Instrument Details</h2>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="flex flex-col space-y-1">
                                        <label className="text-xs font-medium text-slate-400 uppercase tracking-wider ml-1">Asset Class</label>
                                        <select 
                                            value={category}
                                            onChange={(e) => handleCategoryChange(e.target.value)}
                                            className="w-full bg-slate-800 border border-slate-700 text-slate-100 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 block p-3"
                                        >
                                            {Object.values(CATEGORIES).map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                        </select>
                                    </div>

                                    <div className="flex flex-col space-y-1">
                                        <label className="text-xs font-medium text-slate-400 uppercase tracking-wider ml-1">Pair / Symbol</label>
                                        <select 
                                            value={selectedInstrument ? selectedInstrument.symbol : ''}
                                            onChange={(e) => {
                                                const inst = INSTRUMENTS[category].find(i => i.symbol === e.target.value);
                                                if (inst) setSelectedInstrument(inst);
                                            }}
                                            className="w-full bg-slate-800 border border-slate-700 text-slate-100 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 block p-3"
                                        >
                                            {INSTRUMENTS[category].map(inst => (
                                                <option key={inst.symbol} value={inst.symbol}>{inst.symbol}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>

                                <div className="mt-6 flex gap-4 text-xs text-slate-500 bg-slate-950/50 p-3 rounded-lg border border-slate-800/50">
                                    <div className="flex items-center gap-2">
                                        <Settings className="w-3 h-3" />
                                        <span>Contract Size: <span className="text-blue-400 font-mono">{selectedInstrument ? selectedInstrument.contractSize.toLocaleString() : '-'}</span></span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <Activity className="w-3 h-3" />
                                        <span>Leverage: <span className="text-blue-400 font-mono">1:{selectedInstrument ? selectedInstrument.leverage : '-'}</span></span>
                                    </div>
                                </div>
                            </div>

                            {/* Parameters Card */}
                            <div className="bg-slate-900 border border-slate-800 rounded-2xl p-6 shadow-xl">
                                <div className="flex items-center gap-2 mb-6 border-b border-slate-800 pb-4">
                                    <Calculator className="w-5 h-5 text-indigo-400" />
                                    <h2 className="text-lg font-semibold text-slate-200">Trade Parameters</h2>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="md:col-span-2">
                                        <InputField 
                                            label="Risk Amount (Account Currency)" 
                                            value={riskAmount} 
                                            onChange={setRiskAmount} 
                                            placeholder="e.g. 100" 
                                            prefix="$"
                                        />
                                    </div>

                                    <InputField 
                                        label="Entry Price" 
                                        value={entryPrice} 
                                        onChange={setEntryPrice}
                                        placeholder="0.0000" 
                                    />
                                    <InputField 
                                        label="Stop Loss" 
                                        value={stopLoss} 
                                        onChange={setStopLoss}
                                        placeholder="0.0000" 
                                    />
                                    
                                    <div className="md:col-span-2 grid grid-cols-2 gap-4 bg-slate-800/20 p-4 rounded-xl border border-slate-700/30 border-dashed">
                                        <InputField 
                                            label="Risk : Reward Ratio" 
                                            value={riskReward} 
                                            onChange={handleRRChange} 
                                            placeholder="e.g. 2" 
                                            prefix="1 :"
                                        />
                                        <InputField 
                                            label="Target Price (Auto)" 
                                            value={target} 
                                            onChange={handleTargetChange} 
                                            placeholder="0.0000" 
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* --- Results --- */}
                        <div className="lg:col-span-5">
                            <div className="sticky top-6">
                                <div className={`bg-gradient-to-b from-slate-900 to-slate-900 border border-slate-800 rounded-2xl p-6 shadow-2xl relative overflow-hidden transition-all duration-300 ${results ? 'ring-2 ring-blue-500/20' : ''}`}>
                                    
                                    <div className="absolute top-0 right-0 w-64 h-64 bg-blue-500/5 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none"></div>

                                    <div className="flex items-center gap-2 mb-6 border-b border-slate-800 pb-4 relative z-10">
                                        <DollarSign className="w-5 h-5 text-green-400" />
                                        <h2 className="text-lg font-semibold text-slate-200">Calculated Position</h2>
                                    </div>

                                    {results ? (
                                        <div className="space-y-6 relative z-10">
                                            
                                            <div className="bg-slate-950/50 rounded-xl p-5 border border-slate-800 text-center">
                                                <p className="text-slate-400 text-xs uppercase tracking-widest font-semibold mb-1">Recommended Lot Size</p>
                                                <div className="text-5xl font-bold text-white tracking-tight break-all">
                                                    {results.lotSize < 0.001 
                                                        ? results.lotSize.toExponential(2) 
                                                        : results.lotSize.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })
                                                    }
                                                    <span className="text-lg text-slate-500 font-medium ml-2">lots</span>
                                                </div>
                                                
                                                <div className={`mt-3 inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${results.direction === 'Long' ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}`}>
                                                    {results.direction === 'Long' ? 'ðŸ“ˆ Buy / Long' : 'ðŸ“‰ Sell / Short'}
                                                </div>
                                            </div>

                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700/50">
                                                    <p className="text-slate-400 text-xs mb-1">Margin Required</p>
                                                    <p className="text-xl font-semibold text-slate-200">${results.margin.toLocaleString(undefined, { maximumFractionDigits: 2 })}</p>
                                                </div>
                                                <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700/50">
                                                    <p className="text-slate-400 text-xs mb-1">Risk / Reward</p>
                                                    <p className="text-xl font-semibold text-slate-200">
                                                        {results.rr > 0 ? `1 : ${results.rr.toFixed(2)}` : '---'}
                                                    </p>
                                                </div>
                                            </div>

                                            <div className="space-y-3 pt-2">
                                                <div className="flex justify-between items-center text-sm border-b border-slate-800/50 pb-2">
                                                    <span className="text-slate-400">Total Risk</span>
                                                    <span className="text-red-400 font-medium">-${riskAmount.toLocaleString()}</span>
                                                </div>
                                                {results.rr > 0 && (
                                                    <div className="flex justify-between items-center text-sm border-b border-slate-800/50 pb-2">
                                                        <span className="text-slate-400">Potential Profit</span>
                                                        <span className="text-green-400 font-medium">+${results.potentialProfit.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>
                                                    </div>
                                                )}
                                                <div className="flex justify-between items-center text-sm">
                                                    <span className="text-slate-400">Stop Loss Distance</span>
                                                    <span className="text-slate-300 font-mono">{results.slDistance.toFixed(5)} price units</span>
                                                </div>
                                            </div>

                                        </div>
                                    ) : (
                                        <div className="text-center py-12">
                                            <div className="bg-slate-800/50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                                <AlertCircle className="w-8 h-8 text-slate-600" />
                                            </div>
                                            <p className="text-slate-400">Enter Entry, Stop Loss, and Risk to see results.</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PositionSizeCalculator />);
    </script>
</body>
</html>
